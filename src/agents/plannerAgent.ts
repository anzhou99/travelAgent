import { Agent, AgentInput } from "../types";
import { chatCompletion } from "../lib/fetcher";
import { RecordItem } from "@/model";

const name = "PlannerAgent";
const description =
  "èµ„æ·±æ—…è¡Œè§„åˆ’å¸ˆ, æ“…é•¿å°†ç”¨æˆ·æ„å›¾ã€å¤©æ°”çŠ¶å†µã€äº¤é€šä¿¡æ¯ã€å½“åœ°é£ä¿—ã€ç¾é£Ÿç‰¹è‰²ç­‰å…¨æ–¹ä½èåˆï¼Œç”Ÿæˆä¸€ä»½â€œå³å¼€å³èµ°â€ã€â€œè·Ÿç€èµ°å°±ä¸ä¼šé”™â€çš„æ—…è¡Œæ‰§è¡Œæ‰‹å†Œ";
const inputPrompt = `ä½ å°†æ¥æ”¶åˆ°åŒ…å«ç”¨æˆ·æ—…è¡Œæ„å›¾åˆ†æç»“æœå’Œç”¨æˆ·æ—…è¡ŒæœŸé—´çš„å¤©æ°”ä¿¡æ¯ä¸å»ºè®®çš„ä¸¤æ–¹é¢ä¿¡æ¯çš„æ–‡æœ¬,å…¶JSON Schemaä¸º:
{
type: "string",
description: "'ç”¨æˆ·æ—…è¡Œæ„å›¾åˆ†æç»“æœ'å’Œ'ç”¨æˆ·æ—…è¡ŒæœŸé—´çš„å¤©æ°”ä¿¡æ¯ä¸å»ºè®®'çš„ä¸¤æ–¹é¢ä¿¡æ¯",
}`;
const inputExample = `{
ç”¨æˆ·æ—…è¡Œæ„å›¾åˆ†æç»“æœ:
    ğŸ•ï¸ **ç›®çš„åœ°**ï¼šä¹å¯¨æ²Ÿ
    â° **æ—…è¡Œå¤©æ•°**ï¼š3å¤©
    ğŸ“… **å‡ºå‘æ—¶é—´**ï¼š2025-07-01
    ğŸ“… **æ‰€æœ‰æ—¥æœŸ**ï¼š2025-07-01,2025-07-02,2025-07-03
    ğŸ¯ **åå¥½ç±»å‹**ï¼šè§‚å…‰
    ğŸ’° **é¢„ç®—èŒƒå›´**ï¼š3000
    ğŸ‘¥ **å‡ºè¡Œäººæ•°**ï¼š1äºº**"

ç”¨æˆ·æ—…è¡ŒæœŸé—´çš„å¤©æ°”ä¿¡æ¯ä¸å»ºè®®: 
        **2025-07-01ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜´
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 18Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šå¤©æ°”é˜´å¤©ï¼Œå»ºè®®ç©¿è½»ä¾¿è¡£ç‰©ï¼Œæ³¨æ„é˜²æ½®ï¼›é€‚åˆæˆ·å¤–æ¸¸è§ˆï¼Œä½†éœ€ç•™æ„å¤©æ°”å˜åŒ–ã€‚


        **2025-07-02ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜µé›¨
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 19Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šæœ‰é˜µé›¨ï¼Œå»ºè®®æºå¸¦é›¨å…·ï¼Œç©¿é˜²æ»‘é‹ï¼›å°½é‡é¿å…é•¿æ—¶é—´åœ¨æˆ·å¤–æ´»åŠ¨ï¼Œæ³¨æ„å®‰å…¨ã€‚


        **2025-07-03ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜µé›¨
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 20Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šä»æœ‰é˜µé›¨ï¼Œå»ºè®®æºå¸¦é›¨å…·å¹¶é€‰æ‹©å®¤å†…æˆ–é®é›¨çš„æ´»åŠ¨ï¼›æ³¨æ„ä¿æš–å’Œé˜²æ»‘ã€‚"
}`;

// è§„åˆ’Agent
export const plannerAgent: Agent = {
  name,
  description,
  inputPrompt,
  inputExample,
  systemPrompt: `
## è§’è‰²è®¾å®š
${description}
## ä»»åŠ¡æè¿°
æ ¹æ®ç”¨æˆ·çš„æ—…è¡Œåå¥½ï¼ˆå¦‚ç›®çš„åœ°ã€å‡ºè¡Œæ—¶é—´ã€é¢„ç®—ç­‰ï¼‰ä»¥åŠæŒ‡å®šæ—¥æœŸå†…çš„å¤©æ°”ä¿¡æ¯ï¼Œè¾“å‡ºä¸€ä»½è¯¦ç»†çš„æ—¥ç¨‹è§„åˆ’è¡¨ï¼Œæ¯ä¸€å¤©çš„è¡Œç¨‹ä¸­ï¼Œéœ€åˆ—å‡ºå¤šä¸ªå…·ä½“æ™¯ç‚¹åŠæ´»åŠ¨å»ºè®®ï¼Œå¹¶ä¸ºæ¯ä¸ªæ´»åŠ¨æä¾›æ¸¸ç©æ—¶é—´å»ºè®®ã€æ¨èç†ç”±åŠæ³¨æ„äº‹é¡¹ã€‚
å†…å®¹åŒ…æ‹¬ï¼š
1. æ¯æ—¥çš„æ—¥æœŸ
2. å„æ—¶æ®µä¸»è¦æ´»åŠ¨æˆ–æ™¯ç‚¹å®‰æ’
3. ç®€æ´ä½†å®ç”¨çš„æ—…è¡Œå»ºè®®ï¼ˆå¦‚ç©¿ç€ã€å‡†å¤‡ç‰©å“ã€æ³¨æ„äº‹é¡¹ç­‰ï¼‰

## è¾“å…¥ä¿¡æ¯
${inputPrompt}
## è¾“å…¥ç¤ºä¾‹
${inputExample}

##  æ³¨æ„äº‹é¡¹
1. æ¯å¤©çš„ plan è‡³å°‘åŒ…å«ã€ä¸Šåˆã€‘ã€ã€ä¸­åˆã€‘ã€ã€ä¸‹åˆã€‘3ä¸ªæ—¶æ®µï¼Œæ¯ä¸ªæ—¶æ®µéƒ½éœ€åŒ…å«å…·ä½“æ™¯ç‚¹ä¸ç©æ³•ç»†èŠ‚ã€‚
2. æ´»åŠ¨å†…å®¹ä¸èƒ½åªæ˜¯ä¸€å¥â€œæ¸¸è§ˆÃ—Ã—â€ï¼Œåº”åŒ…æ‹¬ç©æ³•ã€è§‚èµç‚¹ã€æ‹ç…§æ¨èã€é€‚åˆäººç¾¤ã€è´¹ç”¨é¢„ä¼°ã€æ—¶é•¿é¢„ä¼°ã€äº¤é€šå»ºè®®ç­‰ç»†èŠ‚ã€‚
3. æ¯ä¸ªæ´»åŠ¨éƒ½è¦æ­é…ä¸€ä¸ªç®€æ´çš„ notesï¼ŒæŒ‡å‡ºè¯¥æ—¶æ®µçš„æ³¨æ„äº‹é¡¹ã€ç©¿æˆ´å»ºè®®æˆ–å¤©æ°”åº”å¯¹ã€‚
4. å»ºè®®è´´åˆçœŸå®å‡ºè¡Œåœºæ™¯ï¼ˆä¾‹å¦‚ï¼šå»ºè®®æå‰é¢„å®šé—¨ç¥¨/æ™¯åŒºè½¦ç¥¨ã€å°½é‡é€‰æ‹©é è¿‘ä½å®¿åŒºåŸŸçš„æ™¯ç‚¹ ç­‰ï¼‰ã€‚
5. å»ºè®®æ¯æ—¥å»ºè®®ä¸­ä½“ç°å¤©æ°”å»ºè®®çš„åˆç†èåˆã€‚
6. generalTips æ˜¯è¯¥æ—¥çš„æ•´ä½“å»ºè®®ï¼Œå¯ç»“åˆå¤©æ°”å’Œæ™¯åŒºç‰¹ç‚¹ã€‚


## è¾“å‡ºæ ¼å¼
è¯·ä»¥JSONæ ¼å¼è¿”å›ç»“æœã€‚
## è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›ç»“æœï¼š
è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªè¡¨ç¤ºæŸä¸€å¤©çš„è¡Œç¨‹å¯¹è±¡ã€‚ç»“æ„å¦‚ä¸‹ï¼š
  {
    "date": "2025-07-01",
    "plan": [
      {
        "time": "ä¸Šåˆ",
        "activity": "åœ¨ä¹å¯¨æ²Ÿå‰å¾€ã€äº”èŠ±æµ·ã€‘ï¼Œæ¬£èµæ¹–é¢ä¸ƒå½©æ–‘æ–“çš„å€’å½±ï¼Œå»ºè®®æ‹ç…§ç•™å¿µï¼Œå¯é¡ºæ¸¸é™„è¿‘çš„çç æ»©ç€‘å¸ƒã€‚",
        "notes": "é˜´å¤©å…‰çº¿æŸ”å’Œï¼Œé€‚åˆæ‹ç…§ã€‚æ­¥é“è¾ƒæ¹¿æ»‘ï¼Œè¯·ç©¿é˜²æ»‘é‹ã€‚"
      },
      {
        "time": "ä¸­åˆ",
        "activity": "åœ¨è¯ºæ—¥æœ—ä¸­å¿ƒç«™ç”¨åˆé¤ï¼Œä¼‘æ¯ç‰‡åˆ»ã€‚",
        "notes": "å»ºè®®é¿å¼€é«˜å³°æœŸï¼Œå¯ä»¥æå‰å‡†å¤‡ç®€é¤æˆ–é¢„çº¦æ™¯åŒºé¤å…ã€‚"
      },
      {
        "time": "ä¸‹åˆ",
        "activity": "æ¸¸è§ˆã€é•œæµ·ã€‘å’Œã€ç†ŠçŒ«æµ·ã€‘ï¼Œæ²¿æ ˆé“æ­¥è¡Œä½“éªŒå®é™å±±æ°´æ™¯è‰²ã€‚",
        "notes": "è¯·æ³¨æ„æ—¶é—´æ§åˆ¶ï¼Œä»¥å…é”™è¿‡æœ«ç­è§‚å…‰è½¦ã€‚"
      }
    ],
    "generalTips": "å½“å¤©ä¸ºé˜´å¤©ï¼Œæ•´ä½“é€‚åˆæˆ·å¤–æ´»åŠ¨ï¼Œå»ºè®®æ—©ç‚¹å‡ºå‘é¿å¼€äººæµé«˜å³°ï¼Œç©¿è½»ä¾¿è¡£ç‰©ã€æ³¨æ„ä¿æ¹¿ã€‚"
  }

## ç¤ºä¾‹[å¿…é¡»ä¸¥æ ¼å‚è€ƒæ ¼å¼ä¸é£æ ¼]
### ç¤ºä¾‹1
#### ç”¨æˆ·è¾“å…¥
ç”¨æˆ·æ—…è¡Œæ„å›¾åˆ†æç»“æœ:
    ğŸ•ï¸ **ç›®çš„åœ°**ï¼šä¹å¯¨æ²Ÿ
    â° **æ—…è¡Œå¤©æ•°**ï¼š3å¤©
    ğŸ“… **å‡ºå‘æ—¶é—´**ï¼š2025-07-01
    ğŸ“… **æ‰€æœ‰æ—¥æœŸ**ï¼š2025-07-01,2025-07-02,2025-07-03
    ğŸ¯ **åå¥½ç±»å‹**ï¼šè§‚å…‰
    ğŸ’° **é¢„ç®—èŒƒå›´**ï¼š3000
    ğŸ‘¥ **å‡ºè¡Œäººæ•°**ï¼š1äºº**
ç”¨æˆ·æ—…è¡ŒæœŸé—´çš„å¤©æ°”ä¿¡æ¯ä¸å»ºè®®: 
        **2025-07-01ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜´
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 18Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šå¤©æ°”é˜´å¤©ï¼Œå»ºè®®ç©¿è½»ä¾¿è¡£ç‰©ï¼Œæ³¨æ„é˜²æ½®ï¼›é€‚åˆæˆ·å¤–æ¸¸è§ˆï¼Œä½†éœ€ç•™æ„å¤©æ°”å˜åŒ–ã€‚


        **2025-07-02ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜µé›¨
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 19Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šæœ‰é˜µé›¨ï¼Œå»ºè®®æºå¸¦é›¨å…·ï¼Œç©¿é˜²æ»‘é‹ï¼›å°½é‡é¿å…é•¿æ—¶é—´åœ¨æˆ·å¤–æ´»åŠ¨ï¼Œæ³¨æ„å®‰å…¨ã€‚


        **2025-07-03ï¼š**
        ğŸŒ¤ï¸ å¤©æ°”ï¼šé˜µé›¨
        ğŸŒ¡ï¸ æ¸©åº¦ï¼š28Â°C - 20Â°CÂ°C
        ğŸ’¡ å¤©æ°”å»ºè®®ï¼šä»æœ‰é˜µé›¨ï¼Œå»ºè®®æºå¸¦é›¨å…·å¹¶é€‰æ‹©å®¤å†…æˆ–é®é›¨çš„æ´»åŠ¨ï¼›æ³¨æ„ä¿æš–å’Œé˜²æ»‘ã€‚
#### è¾“å‡º
[
  {
    "date": "2025-07-01",
    "plan": [
      {
        "time": "ä¸Šåˆ",
        "activity": "ä¹˜åæ™¯åŒºè§‚å…‰è½¦å‰å¾€ã€äº”èŠ±æµ·ã€‘ï¼Œæ¬£èµæ¹–é¢å¦‚ç”»çš„ä¸ƒå½©å€’å½±å’Œæ¸…æ¾ˆè§åº•çš„æ¹–æ°´ã€‚æ¥ç€å‰å¾€ã€çç æ»©ç€‘å¸ƒã€‘ï¼Œæ„Ÿå—æ°´ç é£æº…å’Œå±±æ—é—´çš„æ°´å£°ã€‚",
        "notes": "é˜´å¤©å…‰çº¿æŸ”å’Œï¼Œéå¸¸é€‚åˆæ‹æ‘„æ¹–æ™¯ï¼Œæ­¥é“å¯èƒ½æœ‰æ°´æ±½ï¼Œè¯·ç©¿é˜²æ»‘é‹ã€‚"
      },
      {
        "time": "ä¸­åˆ",
        "activity": "åœ¨ã€è¯ºæ—¥æœ—æ¸¸å®¢æœåŠ¡ä¸­å¿ƒã€‘ç”¨é¤ï¼Œä¼‘æ¯è¡¥ç»™ï¼Œå¯é€‰æ‹©ç®€é¤æˆ–é¢„è®¢æ™¯åŒºå¥—é¤ã€‚",
        "notes": "å»ºè®®æå‰é¿å¼€åˆé¤é«˜å³°ï¼Œä¸­å¿ƒå†…æœ‰çƒ­æ°´ã€æ´—æ‰‹é—´ç­‰åŸºç¡€è®¾æ–½ã€‚"
      },
      {
        "time": "ä¸‹åˆ",
        "activity": "ç»§ç»­å‰å¾€ã€é•œæµ·ã€‘ï¼Œæ¬£èµå±±æ—å€’å½±å¦‚é•œçš„ç»ç¾æ™¯è‡´ï¼Œé€‚åˆæ‹æ‘„é™æ€é£æ™¯ã€‚ä¹‹åæ¸¸è§ˆã€ç†ŠçŒ«æµ·ã€‘ï¼Œå¯æ­¥è¡Œæ²¿æ ˆé“æ…¢è¡Œï¼Œäº«å—å®é™æ£®æ—ä¸æ¹–æ³Šæ™¯è‰²ã€‚",
        "notes": "ä¸‹åˆå¦‚é‡å¤©æ°”è½¬æ¹¿ï¼Œè¯·é€‚æ—¶æå‰ç»“æŸè¡Œç¨‹ï¼›æ³¨æ„è§‚å…‰è½¦æœ«ç­æ—¶é—´ã€‚"
      }
    ],
    "generalTips": "é˜´å¤©é€‚åˆæˆ·å¤–è§‚æ™¯ï¼Œå»ºè®®ç©¿é€æ°”é€Ÿå¹²è¡£ç‰©å¹¶æºå¸¦ä¸€ä»¶è–„å¤–å¥—ï¼Œæ³¨æ„å±±ä¸­æ¹¿æ°”å’Œæ ˆé“æ¹¿æ»‘ã€‚"
  },
  {
    "date": "2025-07-02",
    "plan": [
      {
        "time": "ä¸Šåˆ",
        "activity": "æ­ä¹˜è§‚å…‰è½¦å‰å¾€ã€æ ‘æ­£æ²Ÿã€‘ï¼Œæ¸¸è§ˆã€æ ‘æ­£ç¾¤æµ·ã€‘ä¸ã€çŠ€ç‰›æµ·ã€‘ï¼Œæ²¿é€”å¯è¾¹èµ°è¾¹çœ‹ï¼Œé€‚åˆè½»æ¾æ…¢è¡Œæ‹ç…§ï¼Œé‡é˜µé›¨å¯å°±è¿‘èº²é¿ã€‚",
        "notes": "é˜µé›¨å¤©æ°”ä¸ç¨³å®šï¼Œå»ºè®®æºå¸¦æŠ˜å ä¼æˆ–é›¨è¡£ï¼Œç©¿é˜²æ»‘é‹ï¼Œå¤‡ä¸€å¥—å¹²è¡£ã€‚"
      },
      {
        "time": "ä¸­åˆ",
        "activity": "åœ¨é è¿‘æ ‘æ­£æ²Ÿçš„å°å‹é£Ÿå ‚ç”¨é¤ï¼Œé¿å…é›¨ä¸­è¿œè·ç¦»ç§»åŠ¨ã€‚å¯åœ¨é¤åçŸ­æš‚ä¼‘æ¯ã€‚",
        "notes": "å»ºè®®ä¸­åˆä¸è¦å‰å¾€åè¿œåŒºåŸŸï¼Œä»¥ä¾¿çµæ´»è°ƒæ•´è¡Œç¨‹ã€‚"
      },
      {
        "time": "ä¸‹åˆ",
        "activity": "å¦‚é›¨åŠ¿è¾ƒå°ï¼Œå¯åœ¨æ²Ÿå£é™„è¿‘å‚è§‚ã€è—æ—æ–‡åŒ–æ‘ã€‘ï¼Œä½“éªŒè—æ–‡åŒ–é£ä¿—ï¼Œä¹Ÿå¯å‰å¾€ã€æ¸¸å®¢æ–‡åŒ–é¦†ã€‘ç­‰å®¤å†…åŒºåŸŸæ´»åŠ¨ã€‚",
        "notes": "æ³¨æ„é›¨å¤©å‡ºè¡Œå®‰å…¨ï¼Œå°½é‡é€‰æ‹©æœ‰é®æŒ¡ã€è®¾æ–½å®Œå–„çš„æ™¯ç‚¹ã€‚"
      }
    ],
    "generalTips": "é˜µé›¨é¢‘ç¹ï¼Œå»ºè®®å½“å¤©ä»¥çµæ´»æœºåŠ¨ã€è½»å¼ºåº¦è¡Œç¨‹ä¸ºä¸»ï¼Œä¼˜å…ˆå®‰æ’å¯å¿«é€Ÿé¿é›¨çš„æ™¯ç‚¹æˆ–æ´»åŠ¨ã€‚"
  },
  {
    "date": "2025-07-03",
    "plan": [
      {
        "time": "ä¸Šåˆ",
        "activity": "å¯å‰å¾€ã€åˆ™æŸ¥æ´¼æ²Ÿã€‘ï¼Œæ¸¸è§ˆã€é•¿æµ·ã€‘å’Œã€äº”å½©æ± ã€‘ï¼Œå»ºè®®æ­ä¹˜è§‚å…‰è½¦ç›´è¾¾åå†æ²¿é€”æ…¢è¡Œã€‚é€”ä¸­æ™¯è‰²å£®ä¸½ï¼Œå³ä½¿çŸ­æš‚åœç•™ä¹Ÿå€¼å¾—ã€‚",
        "notes": "æ—©æ™¨é›¨åŠ¿é€šå¸¸è¾ƒå°ï¼Œé€‚åˆå¿«è¿›å¿«å‡ºå¼æ¸¸è§ˆã€‚è¯·åŠ¡å¿…æºå¸¦é›¨å…·ã€‚"
      },
      {
        "time": "ä¸­åˆ",
        "activity": "åœ¨æ™¯åŒºå†…é«˜å¤„æœåŠ¡ç«™ç”¨é¤åè¿”å›ä½å®¿åœ°ï¼Œå¯é€‰æ‹©æ­ä¹˜ä¸­é€”ä¸‹è¡Œçš„è§‚å…‰è½¦ã€‚",
        "notes": "é«˜æµ·æ‹”åŒºåŸŸæ°”æ¸©è¾ƒä½ï¼Œè¯·å‡†å¤‡ä¿æš–è¡£ç‰©ï¼›ç”¨é¤æ—¶æ³¨æ„è¡¥å……èƒ½é‡é¿å…é«˜åã€‚"
      },
      {
        "time": "ä¸‹åˆ",
        "activity": "æ ¹æ®å¤©æ°”å’Œä½“åŠ›æƒ…å†µï¼Œå¯åœ¨ä½å®¿é™„è¿‘å®‰æ’åŠæ—¥è‡ªç”±æ´»åŠ¨ï¼Œå¦‚è´­ä¹°çºªå¿µå“ã€æ¸©æ³‰æ”¾æ¾ï¼Œæˆ–æ•´ç†è¡Œæã€æ‹ç…§æ‰“å¡ã€‚",
        "notes": "æœ€åä¸€å¤©æ³¨æ„æ”¾æ¾å’Œè°ƒæ•´èŠ‚å¥ï¼Œä¸ºè¿”ç¨‹åšå¥½å‡†å¤‡ï¼›é¿å…ä¸´æ—¶èµ¶è·¯æˆ–ä¸´è¿‘å…³é—­æ—¶æ®µã€‚"
      }
    ],
    "generalTips": "å½“å¤©ä»æœ‰é˜µé›¨ï¼Œå»ºè®®æ´»åŠ¨èŠ‚å¥æ”¾ç¼“ï¼Œç•™è¶³è‡ªç”±æ—¶é—´ã€‚é€‚åˆæ”¶å°¾ã€è¡¥æ‹é—æ¼æ™¯ç‚¹æˆ–è½»æ¾æ¸¸è§ˆã€‚"
  }
]
`,

  async getJSONResult(
    input: AgentInput,
    addRecord?: (record:  RecordItem) => void
  ): Promise<string> {
    addRecord?.({
      id: `plannerAgent_${Date.now()}`,
      name: name,
      type: "agent",
      desc: `å¼€å§‹åˆ¶å®šè¡Œç¨‹...`,
      content: input.query,
      contentType: "text",
      createdAt: Date.now(),
    });
    const plan = await chatCompletion({
      messages: [
        { role: "system", content: this.systemPrompt },
        { role: "user", content: input.query },
      ],
    });

    addRecord?.({
      id: `plannerAgent_${Date.now()}`,
      name: name,
      type: "agent",
      desc: `åˆ¶å®šè¡Œç¨‹å®Œæˆ`,
      content: plan,
      contentType: "json",
      createdAt: Date.now(),
    });

    return plan;
  },

  async makeTextResult(
    planResult: string,
    addRecord?: (record: RecordItem) => void
  ): Promise<string> {
    try {
      // è§£æ plan æ–¹æ³•è¿”å›çš„è¡Œç¨‹æ•°æ®
      const dailyPlans = JSON.parse(planResult);
      addRecord?.({
        id: `plannerAgent_${Date.now()}`,
        name: name,
        type: "agent",
        desc: `å¼€å§‹æ ¼å¼åŒ–è¾“å‡º...`,
        content: planResult,
        contentType: "json",
        createdAt: Date.now(),
      });
      if (!Array.isArray(dailyPlans) || dailyPlans.length === 0) {
        throw new Error("è¡Œç¨‹è§„åˆ’æ•°æ®æ ¼å¼ä¸æ­£ç¡®");
      }

      const duration = dailyPlans.length;
      const startDate = dailyPlans[0].date;
      const endDate = dailyPlans[dailyPlans.length - 1].date;

      // ç”Ÿæˆè¡Œç¨‹æ€»ç»“
      const planSummary = `
**ğŸ¯ ${duration}å¤©è¡Œç¨‹è§„åˆ’å®Œæˆï¼**

**ğŸ“… è¡Œç¨‹æ—¶é—´ï¼š** ${startDate} è‡³ ${endDate}

${dailyPlans
  .map(
    (day: any, index: number) => `
**ç¬¬${index + 1}å¤© (${day.date})**
${day.plan
  .map(
    (activity: { time: string; activity: string; notes: string }) =>
      `ğŸ• ${activity.time}ï¼š${activity.activity}`
  )
  .join("\n")}
ğŸ’¡ **å½“æ—¥å»ºè®®ï¼š** ${day.generalTips}
`
  )
  .join("")}

**âœ¨ è¡Œç¨‹ç‰¹è‰²ï¼š**
- ğŸ“Š æ€»è®¡ ${duration} å¤©å®Œæ•´è§„åˆ’
- ğŸŒ¤ï¸ ç»“åˆå¤©æ°”æƒ…å†µçš„ä¸ªæ€§åŒ–å»ºè®®
- â° è¯¦ç»†çš„æ—¶é—´å®‰æ’å’Œæ´»åŠ¨æŒ‡å¯¼
- ğŸ“ è´´å¿ƒçš„æ³¨æ„äº‹é¡¹å’Œå®ç”¨å»ºè®®
`;

      addRecord?.({
        id: `plannerAgent_${Date.now()}`,
        name: name,
        type: "agent",
        desc: `æ ¼å¼åŒ–è¾“å‡ºå®Œæˆ`,
        content: planSummary,
        contentType: "text",
        createdAt: Date.now(),
      });

      return planSummary;
    } catch (error) {
      const errorMessage = `è¡Œç¨‹è§„åˆ’å¤„ç†å¤±è´¥: ${
        error instanceof Error ? error.message : "æœªçŸ¥é”™è¯¯"
      }`;

      return errorMessage;
    }
  },
};
